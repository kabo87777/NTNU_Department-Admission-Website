services:
  caddy:
    image: "{{ DOCKER_IMAGE }}"
    restart: always
    networks:
      - traefik
    logging:
      driver: "json-file"
      options:
        max-size: "200k"
        max-file: "10"
    labels:
      traefik.enable: "true"
      traefik.http.routers.{{ TRAEFIK_INTERNAL_NAME }}.rule: "Host(`{{ DOMAIN }}`)"
      traefik.http.routers.{{ TRAEFIK_INTERNAL_NAME }}.tls.certResolver: "http"
      traefik.http.services.{{ TRAEFIK_INTERNAL_NAME }}.loadbalancer.server.port: "3000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1:80/"]
      interval: 1s
      timeout: 3s
      retries: 60

networks:
  traefik:
    external: true
